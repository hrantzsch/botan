language: cpp

sudo: required

env:
  global:
    - CCACHE_MAXSIZE=1G
    - PKCS11_LIB=/usr/lib/softhsm/libsofthsm2.so

jobs:
  include:
    - os: osx
      name: xcode93
      compiler: clang
      osx_image: xcode9.3
      env:
       - TARGET="static"

    - os: osx
      name: xcode93_no_aes_ni
      compiler: clang
      osx_image: xcode9.3
      env:
       - TARGET="no_aes_ni"

install:
  - ./src/scripts/ci/setup_travis.sh

script:
  - ./src/scripts/ci_build.py --os=$TRAVIS_OS_NAME --cc=$CC --cc-bin=$CXX --without-pylint3 --pkcs11-lib=$PKCS11_LIB $EXTRA_FLAGS $TARGET

# whitelist branches to avoid testing feature branches twice (as branch and as pull request)
branches:
  only:
    - master
    - release-2
    - coverity_scan
    - ci/gcc48amalgamation

git:
  depth: 10

cache:
  ccache: true

addons:
  coverity_scan:
    project:
      name: "randombit/botan"
    notification_email: jack@randombit.net
    build_command_prepend: "./configure.py --no-optimizations --with-zlib --with-openssl"
    build_command: "make -j2"
    branch_pattern: coverity_scan
